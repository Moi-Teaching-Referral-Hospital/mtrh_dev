!function(){"use strict";function e(e){frappe.after_ajax(function(){var e=frappe.get_route();"Form"==e[0]&&frappe.ui.form.on(e[1],{refresh:function(e){if(1!==e.doc.__unsaved){var o=frappe.workflow.get_state_fieldname(e.doctype);e.doc[o]&&frappe.workflow.get_transitions(e.doc).then(function(o){e.page.clear_actions_menu(),o.forEach(function(o){var n,a,t;frappe.user_roles.includes(o.allowed)&&(n=o,a=!1,("Administrator"===(t=frappe.session.user)||n.allow_self_approval||t!==e.doc.owner)&&(a=!0),a)&&e.page.add_action_item(__(o.action),function(){o.action.toLowerCase().includes("approve")||o.action.toLowerCase().includes("cancel")||o.action.toLowerCase().includes("submit")||o.action.toLowerCase().includes("reject")||o.action.toLowerCase().includes("terminate")||o.action.toLowerCase().includes("recall")||o.action.toLowerCase().includes("confirm")||o.action.toLowerCase().includes("send")?frappe.confirm('Are you sure you want to "'+o.action+'" the document '+e.doc.name+"?",function(){frappe.prompt([{label:"Enter narative for your decision to "+o.action+". Document: "+e.doc.name,fieldtype:"Small Text",reqd:!0,fieldname:"reason"}],function(n){e.timeline.insert_comment("Decision: "+o.action+" - Memo : "+n.reason),e.selected_workflow_action=o.action,e.script_manager.trigger("before_workflow_action").then(function(){frappe.xcall("frappe.model.workflow.apply_workflow",{doc:e.doc,action:o.action}).then(function(o){frappe.model.sync(o),e.refresh(),e.selected_workflow_action=null,e.script_manager.trigger("after_workflow_action")})})})},function(){validated=!1,window.close()}):(e.selected_workflow_action=o.action,e.script_manager.trigger("before_workflow_action").then(function(){frappe.xcall("frappe.model.workflow.apply_workflow",{doc:e.doc,action:o.action}).then(function(o){frappe.model.sync(o),e.refresh(),e.selected_workflow_action=null,e.script_manager.trigger("after_workflow_action")})}))})})})}}})})}$(window).on("hashchange",e),$(window).on("load",e),frappe.realtime.on("doc_comment",function(e){frappe.prompt([{label:"Enter narative for your decision to "+e.decision+". Document: "+doc.doc_name,fieldtype:"Small Text",reqd:!0,fieldname:"reason"}],function(o){console.log("Reason: "+o.reason),d=frappe.get_doc(doc.doc_type,doc.doc_name),d.add_comment("The document decision: "+e.decision+": "+o.reason)})})}();
//# sourceMappingURL=utilities.min.js.map
