!function(){"use strict";function o(o){frappe.after_ajax(function(){var o=frappe.get_route();"Form"==o[0]&&(console.log("1. "+o[1]+", 2: "+o[2]+", 3: "+cur_frm.doc.name+", 4: "+cur_frm.doc.doctype),frappe.call({method:"mtrh_dev.mtrh_dev.tender_quotation_utils.document_dashboard",args:{docname:o[2],doctype:o[1]},callback:function(o){console.log("DASHBOARD: "+o.message),cur_frm.dashboard.add_section("<div id='divdash'>"+o.message+"</div>"),cur_frm.dashboard.show()}}),frappe.ui.form.on(o[1],{onload_post_render:function(o){},refresh:function(o){if(console.log("Beginning execution..."),1!==o.doc.__unsaved){o.is_new();var e=frappe.workflow.get_state_fieldname(o.doctype);o.doc[e]&&frappe.workflow.get_transitions(o.doc).then(function(e){o.page.clear_actions_menu(),e.forEach(function(e){var n,a,t;frappe.user_roles.includes(e.allowed)&&(n=e,a=!1,("Administrator"===(t=frappe.session.user)||n.allow_self_approval||t!==o.doc.owner)&&(a=!0),a)&&o.page.add_action_item(__(e.action),function(){workflowstate_includes_scm=!1,o.doc.workflow_state&&(workflowstate_includes_scm=o.doc.workflow_state.toLowerCase().includes("scm")),workflowstate_includes_scm||e.action.toLowerCase().includes("confirm")||e.action.toLowerCase().includes("approve")||e.action.toLowerCase().includes("cancel")||e.action.toLowerCase().includes("submit")||e.action.toLowerCase().includes("reject")||e.action.toLowerCase().includes("terminate")||e.action.toLowerCase().includes("recall")||e.action.toLowerCase().includes("confirm")||e.action.toLowerCase().includes("send")?frappe.confirm('Are you sure you want to "'+e.action+'" the document '+o.doc.name+"?",function(){frappe.prompt([{label:"Enter narative for your decision to "+e.action+". Document: "+o.doc.name,fieldtype:"Small Text",reqd:!0,fieldname:"reason"}],function(n){o.timeline.insert_comment("Decision: "+e.action+" - Memo : "+n.reason),o.selected_workflow_action=e.action,o.script_manager.trigger("before_workflow_action").then(function(){frappe.xcall("frappe.model.workflow.apply_workflow",{doc:o.doc,action:e.action}).then(function(e){frappe.model.sync(e),o.refresh(),o.selected_workflow_action=null,o.script_manager.trigger("after_workflow_action")})})})},function(){validated=!1,window.close()}):(o.selected_workflow_action=e.action,o.script_manager.trigger("before_workflow_action").then(function(){frappe.xcall("frappe.model.workflow.apply_workflow",{doc:o.doc,action:e.action}).then(function(e){frappe.model.sync(e),o.refresh(),o.selected_workflow_action=null,o.script_manager.trigger("after_workflow_action")})}))})})})}else console.log("Is Dirty")}}))})}$(window).on("hashchange",o),$(window).on("load",o),frappe.realtime.on("doc_comment",function(o){frappe.prompt([{label:"Enter narative for your decision to "+o.decision+". Document: "+doc.doc_name,fieldtype:"Small Text",reqd:!0,fieldname:"reason"}],function(e){console.log("Reason: "+e.reason),d=frappe.get_doc(doc.doc_type,doc.doc_name),d.add_comment("The document decision: "+o.decision+": "+e.reason)})})}();
//# sourceMappingURL=utilities.min.js.map
